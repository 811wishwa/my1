
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>💾 Link Saver Chat</title>
<style>
body { font-family: Arial; background: #f4f4f4; padding: 20px; }
h2 { text-align: center; }
#chat-box { background: #fff; border-radius: 10px; padding: 10px; height: 400px; overflow-y: auto; }
.message { background: #e6f3ff; border-radius: 8px; padding: 8px 12px; margin: 8px 0; }
.link-preview { background: #f9f9f9; border: 1px solid #ddd; border-radius: 8px; padding: 8px; margin-top: 5px; display:flex; gap:10px; }
.link-preview img { width: 80px; height: 80px; object-fit: cover; border-radius: 6px; }
#input-area { display:flex; gap: 8px; margin-top:10px; }
input, select, button { padding: 8px; border-radius:5px; border:1px solid #ccc; }
button { background: #007bff; color: white; cursor:pointer; border:none; }
</style>
</head>
<body>

<h2>💾 Link Saver Chat</h2>

<div style="text-align:center; margin-bottom:10px;">
  <label for="api-select">Select API: </label>
  <select id="api-select">
    <option value="linkPreview">LinkPreview</option>
    <option value="microlink">Microlink.io</option>
    <option value="iframely">Iframely</option>
    <option value="noembed">Noembed</option>
  </select>
</div>

<div id="chat-box"></div>

<div id="input-area">
  <input type="text" id="message-input" placeholder="Type message or paste a link..." />
  <button id="send-btn">Send</button>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const input = document.getElementById("message-input");
const sendBtn = document.getElementById("send-btn");
const apiSelect = document.getElementById("api-select");

const apiKeys = {
  linkPreview: 'a22398b655223c837bf83d7aa173fef2',
  iframely: '7b7bdfd747591112e2adda', // fixed key for Iframely
  microlink: null // optional Microlink API key
};

function extractUrls(text) {
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  return text.match(urlRegex);
}

async function fetchPreview(url, apiName) {
  try {
    if(apiName === 'linkPreview'){
      const res = await fetch(`https://api.linkpreview.net/?key=${apiKeys.linkPreview}&q=${encodeURIComponent(url)}`);
      const data = await res.json();
      return { title: data.title, description: data.description, image: data.image };

    } else if(apiName === 'microlink'){
      let endpoint = `https://api.microlink.io?url=${encodeURIComponent(url)}&meta=true`;
      if(apiKeys.microlink) endpoint += `&apiKey=${apiKeys.microlink}`;
      const res = await fetch(endpoint);
      const data = await res.json();
      return { title: data.data?.title, description: data.data?.description, image: data.data?.image?.url };

    } else if(apiName === 'iframely'){
      const res = await fetch(`https://iframe.ly/api/iframely?url=${encodeURIComponent(url)}&api_key=${apiKeys.iframely}`);
      const data = await res.json();
      let imageUrl = data.meta?.image;
      if(!imageUrl && data.links && data.links.length>0){
        const linkImg = data.links.find(l => l.rel && (l.rel.includes('thumbnail') || l.rel.includes('image')));
        if(linkImg) imageUrl = linkImg.href;
      }
      return { title: data.meta?.title, description: data.meta?.description, image: imageUrl };

    } else if(apiName === 'noembed'){
      const res = await fetch(`https://noembed.com/embed?url=${encodeURIComponent(url)}`);
      const data = await res.json();
      return { title: data.title, description: data.author_name || '', image: data.thumbnail_url };
    }
  } catch(err){
    console.warn(`${apiName} failed: ${err.message}`);
    return null;
  }
}

async function showLinkPreview(url, container){
  const apiName = apiSelect.value;
  const preview = await fetchPreview(url, apiName);
  if(preview && (preview.title || preview.image)){
    const card = document.createElement('div');
    card.className = 'link-preview';
    card.innerHTML = `
      ${preview.image ? `<img src="${preview.image}" alt="">` : ""}
      <div>
        <h4>${preview.title || 'No title'}</h4>
        <p>${preview.description || ''}</p>
        <a href="${url}" target="_blank">${url}</a>
      </div>
    `;
    container.appendChild(card);
  } else {
    const failMsg = document.createElement('div');
    failMsg.textContent = `⚠️ No preview available from ${apiName}.`;
    container.appendChild(failMsg);
  }
  chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  input.value = '';

  const msgDiv = document.createElement('div');
  msgDiv.className = 'message';
  msgDiv.textContent = text;
  chatBox.appendChild(msgDiv);

  const urls = extractUrls(text);
  if(urls && urls.length>0) showLinkPreview(urls[0], msgDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
}

sendBtn.onclick = sendMessage;
input.addEventListener("keypress", e => { if(e.key === "Enter") sendMessage(); });
</script>
</body>
</html>


